import{p as ue,aX as ie,aY as de,g as ce,aZ as ve,D as me,a_ as fe,o as $,x as c,s as ge,H as pe,A as Ve,z as U,B as xe,u as be,a$ as ye,b0 as ae,b1 as we,c as t,b2 as he,G as K,Y as q,R as te,aI as ke,b3 as Ce,b4 as Pe,Z as Fe,aq as X,b5 as Se,v as Ie,y as _e,ae as Be,a4 as Me,af as Ae,a5 as le,ag as Re,a7 as d,ak as Ue,ac as Te,X as E,ab as G,aa as Y,b6 as De,V as Ne,a6 as ze,ao as He,a8 as u,a9 as $e,al as Ee,aA as Ge,ap as qe,am as Oe,an as Le,ai as je,T as Ke,at as Xe,au as Ye,ah as Ze}from"./index-78fd00a0.js";import{c as Je,a as Z,e as Qe,f as We,u as ea,d as T}from"./index.esm-d640a4e5.js";import{a as aa,V as J}from"./VCol-bfcc8725.js";import{V as ta}from"./VRow-7a194c40.js";import{V as la}from"./VDivider-211c1553.js";import{V as oa,a as sa}from"./VDataTableServer-14dd9a1a.js";import{V as na}from"./VForm-bedf4e9d.js";import{a as ra}from"./VDataTable-b03c7409.js";import"./VList-f8403e93.js";import"./ssrBoot-bca27b78.js";import"./VSlideGroup-41d4a5db.js";const ua=ue({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...ie(),...de()},"VTextarea"),ia=ce()({name:"VTextarea",directives:{Intersect:ve},inheritAttrs:!1,props:ua(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,B){let{attrs:F,emit:M,slots:m}=B;const i=me(e,"modelValue"),{isFocused:h,focus:D,blur:N}=fe(e),O=$(()=>typeof e.counterValue=="function"?e.counterValue(i.value):(i.value||"").toString().length),L=$(()=>{if(F.maxlength)return F.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function A(o,v){var r,f;!e.autofocus||!o||(f=(r=v[0].target)==null?void 0:r.focus)==null||f.call(r)}const z=c(),x=c(),S=ge(""),b=c(),_=$(()=>e.persistentPlaceholder||h.value||e.active);function k(){var o;b.value!==document.activeElement&&((o=b.value)==null||o.focus()),h.value||D()}function C(o){k(),M("click:control",o)}function H(o){M("mousedown:control",o)}function j(o){o.stopPropagation(),k(),X(()=>{i.value="",Se(e["onClick:clear"],o)})}function R(o){var r;const v=o.target;if(i.value=v.value,(r=e.modelModifiers)!=null&&r.trim){const f=[v.selectionStart,v.selectionEnd];X(()=>{v.selectionStart=f[0],v.selectionEnd=f[1]})}}const p=c(),y=c(+e.rows),I=$(()=>["plain","underlined"].includes(e.variant));pe(()=>{e.autoGrow||(y.value=+e.rows)});function P(){e.autoGrow&&X(()=>{if(!p.value||!x.value)return;const o=getComputedStyle(p.value),v=getComputedStyle(x.value.$el),r=parseFloat(o.getPropertyValue("--v-field-padding-top"))+parseFloat(o.getPropertyValue("--v-input-padding-top"))+parseFloat(o.getPropertyValue("--v-field-padding-bottom")),f=p.value.scrollHeight,n=parseFloat(o.lineHeight),l=Math.max(parseFloat(e.rows)*n+r,parseFloat(v.getPropertyValue("--v-input-control-height"))),V=parseFloat(e.maxRows)*n+r||1/0,a=_e(f??0,l,V);y.value=Math.floor((a-r)/n),S.value=Ie(a)})}Ve(P),U(i,P),U(()=>e.rows,P),U(()=>e.maxRows,P),U(()=>e.density,P);let g;return U(p,o=>{o?(g=new ResizeObserver(P),g.observe(p.value)):g==null||g.disconnect()}),xe(()=>{g==null||g.disconnect()}),be(()=>{const o=!!(m.counter||e.counter||e.counterValue),v=!!(o||m.details),[r,f]=ye(F),{modelValue:n,...l}=ae.filterProps(e),V=we(e);return t(ae,K({ref:z,modelValue:i.value,"onUpdate:modelValue":a=>i.value=a,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":I.value},e.class],style:e.style},r,l,{centerAffix:y.value===1&&!I.value,focused:h.value}),{...m,default:a=>{let{id:s,isDisabled:w,isDirty:Q,isReadonly:oe,isValid:se}=a;return t(he,K({ref:x,style:{"--v-textarea-control-height":S.value},onClick:C,onMousedown:H,"onClick:clear":j,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},V,{id:s.value,active:_.value||Q.value,centerAffix:y.value===1&&!I.value,dirty:Q.value||e.dirty,disabled:w.value,focused:h.value,error:se.value===!1}),{...m,default:ne=>{let{props:{class:W,...ee}}=ne;return t(q,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),te(t("textarea",K({ref:b,class:W,value:i.value,onInput:R,autofocus:e.autofocus,readonly:oe.value,disabled:w.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:k,onBlur:N},ee,f),null),[[ke("intersect"),{handler:A},null,{once:!0}]]),e.autoGrow&&te(t("textarea",{class:[W,"v-textarea__sizer"],id:`${ee.id}-sizer`,"onUpdate:modelValue":re=>i.value=re,ref:p,readonly:!0,"aria-hidden":"true"},null),[[Ce,i.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:v?a=>{var s;return t(q,null,[(s=m.details)==null?void 0:s.call(m,a),o&&t(q,null,[t("span",null,null),t(Pe,{active:e.persistentCounter||h.value,value:O.value,max:L.value},m.counter)])])}:void 0})}),Fe({},z,x,b)}});const da=e=>(Xe("data-v-464398b5"),e=e(),Ye(),e),ca=da(()=>Ze("h1",{class:"text-center"},"商品管理",-1)),va={__name:"ProductsView",setup(e){const{apiAuth:B}=Te(),F=Me(),M=c(null),m=c(!1),i=c(""),h=n=>{n?(i.value=n._id,x.value.value=n.name,S.value.value=n.price,b.value.value=n.description,_.value.value=n.category,k.value.value=n.sell):i.value="",m.value=!0},D=()=>{m.value=!1,z(),M.value.deleteFileRecord()},N=["地區回饋","愛心公益","學校認同","市民卡","公會組織"],O=Je({name:Z().required("缺少商品名稱"),price:Qe().typeError("商品價格格式錯誤").required("缺少商品價格").min(0,"商品價格不能小於 0"),description:Z().required("缺少商品說明"),category:Z().required("缺少商品分類").test("isCategory","商品分類錯誤",n=>N.includes(n)),sell:We()}),{handleSubmit:L,isSubmitting:A,resetForm:z}=ea({validationSchema:O,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),x=T("name"),S=T("price"),b=T("description"),_=T("category"),k=T("sell"),C=c([]),H=c([]),j=L(async n=>{var l,V,a;if(!((l=C.value[0])!=null&&l.error)&&!(i.value===""&&C.value.length===0))try{const s=new FormData;for(const w in n)s.append(w,n[w]);C.value.length>0&&s.append("image",C.value[0].file),i.value===""?await B.post("/products",s):await B.patch("/products/"+i.value,s),F({text:i.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),D(),f()}catch(s){console.log(s);const w=((a=(V=s==null?void 0:s.response)==null?void 0:V.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";F({text:w,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),R=c(10),p=c([{key:"createdAt",order:"desc"}]),y=c(1),I=c([]),P=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"申請費用",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],g=c(!0),o=c(0),v=c(""),r=async()=>{var n,l,V,a;g.value=!0;try{const{data:s}=await B.get("/products/all",{params:{page:y.value,itemsPerPage:R.value,sortBy:((n=p.value[0])==null?void 0:n.key)||"createdAt",sortOrder:((l=p.value[0])==null?void 0:l.order)==="asc"?1:-1,search:v.value}});I.value.splice(0,I.value.length,...s.result.data),o.value=s.result.total}catch(s){console.log(s);const w=((a=(V=s==null?void 0:s.response)==null?void 0:V.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";F({text:w,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}g.value=!1};r();const f=()=>{y.value=1,r()};return(n,l)=>{const V=Ae("VueFileAgent");return le(),Re(q,null,[t(aa,{class:"custom-font"},{default:d(()=>[t(ta,null,{default:d(()=>[t(J,{cols:"12"},{default:d(()=>[ca]),_:1}),t(la),t(J,{cols:"12"},{default:d(()=>[t(E,{color:"green",onClick:l[0]||(l[0]=a=>h())},{default:d(()=>[G("新增你的認同卡")]),_:1})]),_:1}),t(J,{cols:"12"},{default:d(()=>[t(oa,{"items-per-page":R.value,"onUpdate:itemsPerPage":[l[2]||(l[2]=a=>R.value=a),r],"sort-by":p.value,"onUpdate:sortBy":[l[3]||(l[3]=a=>p.value=a),r],page:y.value,"onUpdate:page":[l[4]||(l[4]=a=>y.value=a),r],items:I.value,headers:P,loading:g.value,"items-length":o.value,search:v.value,hover:""},{top:d(()=>[t(Y,{label:"搜尋","append-icon":"mdi-magnify",modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=a=>v.value=a),"onClick:append":f,onKeydown:De(f,["enter"])},null,8,["modelValue"])]),"item.image":d(({item:a})=>[t(Ne,{src:a.image,height:"50px"},null,8,["src"])]),"item.sell":d(({item:a})=>[a.sell?(le(),ze(Ke,{key:0,icon:"mdi-check"})):He("",!0)]),"item.edit":d(({item:a})=>[t(E,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:s=>h(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(Ue,{class:"custom-font",modelValue:m.value,"onUpdate:modelValue":l[12]||(l[12]=a=>m.value=a),persistent:"",width:"500px"},{default:d(()=>[t(na,{disabled:u(A),onSubmit:$e(u(j),["prevent"])},{default:d(()=>[t(Ee,null,{default:d(()=>[t(Ge,null,{default:d(()=>[G(qe(i.value===""?"新增卡頁":"編輯卡頁"),1)]),_:1}),t(Oe,null,{default:d(()=>[t(Y,{label:"名稱",modelValue:u(x).value.value,"onUpdate:modelValue":l[5]||(l[5]=a=>u(x).value.value=a),"error-messages":u(x).errorMessage.value},null,8,["modelValue","error-messages"]),t(Y,{label:"費用",type:"number",min:"0",modelValue:u(S).value.value,"onUpdate:modelValue":l[6]||(l[6]=a=>u(S).value.value=a),"error-messages":u(S).errorMessage.value},null,8,["modelValue","error-messages"]),t(ra,{label:"分類",items:N,modelValue:u(_).value.value,"onUpdate:modelValue":l[7]||(l[7]=a=>u(_).value.value=a),"error-messages":u(_).errorMessage.value},null,8,["modelValue","error-messages"]),t(sa,{label:"上架",modelValue:u(k).value.value,"onUpdate:modelValue":l[8]||(l[8]=a=>u(k).value.value=a),"error-messages":u(k).errorMessage.value},null,8,["modelValue","error-messages"]),t(ia,{label:"說明",modelValue:u(b).value.value,"onUpdate:modelValue":l[9]||(l[9]=a=>u(b).value.value=a),"error-messages":u(b).errorMessage.value},null,8,["modelValue","error-messages"]),t(V,{modelValue:C.value,"onUpdate:modelValue":l[10]||(l[10]=a=>C.value=a),rawModelValue:H.value,"onUpdate:rawModelValue":l[11]||(l[11]=a=>H.value=a),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},"help-text":"選擇檔案或拖曳到這裡","max-files":1,"max-size":"1MB",ref_key:"fileAgent",ref:M},null,8,["modelValue","rawModelValue"])]),_:1}),t(Le,null,{default:d(()=>[t(je),t(E,{color:"red",disabled:u(A),onClick:D},{default:d(()=>[G("取消")]),_:1},8,["disabled"]),t(E,{color:"green",type:"submit",loading:u(A)},{default:d(()=>[G("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}},Ca=Be(va,[["__scopeId","data-v-464398b5"]]);export{Ca as default};
